const fortsData = {
  pratapgad: {
    coordinates: { lat: 17.9436, lng: 73.7169 },
    en: {
      name: "Pratapgad",
      location: "Satara District",
      baseVillage: "Poladpur/Kinesvar",
      difficulty: "Moderate",
      height: "1,080 meters",
      duration: "3-4 hours",
      distance: "4-5 km",
      bestTime: "October to March",
      grade: "Moderate",
      description: "Famous for Shivaji Maharaj's victory, Pratapgad's lush slopes and iconic watchtowers offer breathtaking Sahyadri views and rich Maratha heritage.",
      history: "Built in 1656 by Chhatrapati Shivaji Maharaj, Pratapgad Fort holds immense historical significance as the site of the famous Battle of Pratapgad in 1659. Here, Shivaji Maharaj defeated Afzal Khan, the Bijapur Sultanate general, in a decisive encounter that established Maratha supremacy. The fort's name means 'Fort of Valour,' reflecting its role in Maratha military history.",
      structures: ["Bhavani Temple built by Shivaji", "Afzal Khan's tomb", "Ancient bastions and ramparts", "Royal quarters ruins"],
      waterSources: ["Four seasonal lakes", "Natural water cisterns", "Stone-carved water channels"],
      temples: ["Bhavani Temple", "Mahadev Temple", "Various small shrines"],
      viewpoints: ["Main fort plateau", "Eastern watchtower", "Afzal Khan's tomb viewpoint"],
      attractions: ["Battle of Pratapgad memorial", "Shivaji's sword display", "Ancient weapon collection", "Historical artifacts museum"],
      photographySpots: ["Sunrise from east bastion", "Bhavani Temple architecture", "Valley views from ramparts", "Monsoon waterfall cascades"],
      wildlife: ["Langur monkeys", "Peacocks and peafowl", "Wildflowers in monsoon", "Dense forest vegetation"],
      facilities: ["Parking area", "Basic refreshment stalls", "Rest rooms", "First aid post"],
      routeDescription: "The trek begins from the base village with well-marked stone steps leading through dense forests. The path includes moderate climbs with occasional steep sections near the fort entrance.",
      baseVillageDetails: "Poladpur and Kinesvar serve as base villages, offering basic amenities like food, accommodation, and local guides. Both villages are well-connected by road from Mahabaleshwar.",
      pointsOfInterest: [
        { name: "Bhavani Temple", lat: 17.9440, lng: 73.7165, type: "temple" },
        { name: "Afzal Khan Tomb", lat: 17.9430, lng: 73.7175, type: "monument" },
        { name: "Eastern Watchtower", lat: 17.9445, lng: 73.7180, type: "viewpoint" },
        { name: "Main Fort Entrance", lat: 17.9435, lng: 73.7170, type: "entrance" }
      ]
    }
  },
  raigad: {
    coordinates: { lat: 18.2348, lng: 73.4399 },
    en: {
      name: "Raigad",
      location: "Raigad District", 
      baseVillage: "Pachad",
      difficulty: "Moderate",
      height: "820 meters",
      duration: "4-5 hours",
      distance: "3 km",
      bestTime: "October to March",
      grade: "Moderate",
      description: "Capital fort of the Marathas, Raigad is steeped in history with its famed ropeway and grand Maha Darwaja, serving as the coronation site of Shivaji Maharaj.",
      history: "Raigad served as the capital of the Maratha Empire and the coronation site of Chhatrapati Shivaji Maharaj in 1674. Originally called Rairi, it was fortified and renamed by Shivaji. The fort witnessed the golden age of the Maratha Empire and houses the samadhi of Shivaji Maharaj.",
      structures: ["Raj Bhavan (Royal Palace)", "Hatti Talav (Elephant Tank)", "Coronation Platform", "Queen's Quarters", "Takmak Tok (Execution Point)"],
      waterSources: ["Ganga Sagar Lake", "Multiple stone cisterns", "Natural springs"],
      temples: ["Jagdishwar Temple", "Shirkai Devi Temple", "Samadhi of Shivaji Maharaj"],
      viewpoints: ["Takmak Tok", "Palace ruins", "Main fort plateau", "Ropeway viewpoint"],
      attractions: ["Shivaji's coronation platform", "Royal treasury remains", "Ancient coin collection", "Maratha architecture exhibits"],
      photographySpots: ["Sunrise from Takmak Tok", "Raj Bhavan ruins silhouette", "Ropeway aerial views", "Samadhi monument architecture"],
      wildlife: ["Monkeys and langurs", "Various bird species", "Medicinal plants", "Indigenous flora"],
      facilities: ["Ropeway service", "Museum and exhibition", "Cafeteria", "Parking facilities"],
      routeDescription: "Access via ropeway or trekking path from Pachad village. The trek involves stone steps and moderate climbs through forested areas with historical ruins along the way.",
      baseVillageDetails: "Pachad village offers accommodation, food, and ropeway access. The village has good connectivity from Mumbai and Pune with regular bus services.",
      pointsOfInterest: [
        { name: "Raj Bhavan", lat: 18.2350, lng: 73.4395, type: "palace" },
        { name: "Coronation Platform", lat: 18.2345, lng: 73.4400, type: "monument" },
        { name: "Takmak Tok", lat: 18.2355, lng: 73.4405, type: "viewpoint" },
        { name: "Samadhi", lat: 18.2347, lng: 73.4397, type: "memorial" }
      ]
    }
  },
  sinhagad: {
    coordinates: { lat: 18.3663, lng: 73.7559 },
    en: {
      name: "Sinhagad",
      location: "Pune District",
      baseVillage: "Donje",
      difficulty: "Easy to Moderate",
      height: "1,312 meters",
      duration: "2-3 hours",
      distance: "3-4 km",
      bestTime: "June to February",
      grade: "Easy to Moderate",
      description: "A popular trekking destination, Sinhagad Fort offers scenic views of the Sahyadri hills and holds legendary tales of Tanaji Malusare’s valor in defending the fort.",
      history: "Originally known as Kondhana, the fort was renamed 'Sinhagad' (Lion's Fort) after the legendary battle in which Tanaji Malusare, a trusted commander of Shivaji Maharaj, sacrificed his life to recapture the fort from the Mughals in 1670.",
      structures: ["Tanaji Malusare Memorial", "Pune Darwaza", "Kalyan Darwaza", "Old military barracks"],
      waterSources: ["Devtake (natural spring)", "Rainwater tanks", "Stone reservoirs"],
      temples: ["Kali Mata Temple", "Hanuman Temple", "Amruteshwar Temple"],
      viewpoints: ["Kalyan Darwaza point", "Pune Darwaza cliff", "Tanaji’s memorial viewpoint"],
      attractions: ["Historic memorials", "Ruins of old fort walls", "Freshly made traditional food at stalls", "Panoramic view of Pune city"],
      photographySpots: ["View of Khadakwasla Dam", "Sunset over Sahyadris", "Ruined gateways", "Foggy mornings in monsoon"],
      wildlife: ["Eagles and kites", "Monkeys", "Wildflowers", "Occasional leopards in the forest range"],
      facilities: ["Local food stalls", "Rest huts", "Drinking water points", "Parking at base village"],
      routeDescription: "The trek from Donje village is short and scenic with well-trodden paths. For convenience, vehicles can also reach the top via a motorable road.",
      baseVillageDetails: "Donje is the primary base village with ample parking and eateries. It is easily accessible from Pune by road or bus.",
      pointsOfInterest: [
        { name: "Tanaji Memorial", lat: 18.3666, lng: 73.7552, type: "monument" },
        { name: "Pune Darwaza", lat: 18.3658, lng: 73.7549, type: "entrance" },
        { name: "Kalyan Darwaza", lat: 18.3672, lng: 73.7571, type: "entrance" },
        { name: "Kali Mata Temple", lat: 18.3665, lng: 73.7565, type: "temple" }
      ]
    }
  },
  shivneri: {
    coordinates: { lat: 19.1868, lng: 73.8655 },
    en: {
      name: "Shivneri",
      location: "Junnar, Pune District",
      baseVillage: "Junnar",
      difficulty: "Easy",
      height: "1,080 meters",
      duration: "1-2 hours",
      distance: "2-3 km",
      bestTime: "November to February",
      grade: "Easy",
      description: "Shivneri Fort is the birthplace of Chhatrapati Shivaji Maharaj and is a site of great historical and cultural significance with well-preserved fortifications and serene surroundings.",
      history: "Shivneri Fort is renowned as the birthplace of Chhatrapati Shivaji Maharaj in 1630. The fort was of strategic importance to the Marathas and was a symbol of the vision and early life of the great warrior king.",
      structures: ["Shivaji Maharaj’s Birthplace", "Badami Talav (lake)", "Massive stone gates", "Fort ramparts and bastions"],
      waterSources: ["Badami Talav", "Rock-cut water tanks", "Natural springs"],
      temples: ["Shivai Devi Temple", "Ganesh Temple"],
      viewpoints: ["Fort entrance view", "Hilltop bastions", "View of Junnar city"],
      attractions: ["Birthplace monument", "Fortified gates", "Panoramic valley views", "Stone inscriptions and carvings"],
      photographySpots: ["Birthplace structure", "Badami Talav reflections", "Fortified gates", "View of Shivneri from base village"],
      wildlife: ["Peacocks", "Squirrels", "Monkeys", "Native birds"],
      facilities: ["Guide boards", "Resting shelters", "Toilets at base", "Drinking water"],
      routeDescription: "The route to the fort is a well-constructed stone path with moderate steps. It is suitable for families and history enthusiasts with scenic beauty along the way.",
      baseVillageDetails: "Junnar town serves as the base with many lodging options, food stalls, and historical landmarks. It is well connected by road to Pune and Mumbai.",
      pointsOfInterest: [
        { name: "Shivaji Birthplace", lat: 19.1870, lng: 73.8660, type: "monument" },
        { name: "Badami Talav", lat: 19.1865, lng: 73.8650, type: "lake" },
        { name: "Shivai Temple", lat: 19.1872, lng: 73.8648, type: "temple" },
        { name: "Main Entrance Gate", lat: 19.1862, lng: 73.8653, type: "entrance" }
      ]
    }
  },
  lohagad: {
    coordinates: { lat: 18.7101, lng: 73.4804 },
    en: {
      name: "Lohagad",
      location: "Lonavala, Pune District",
      baseVillage: "Malavli",
      difficulty: "Easy",
      height: "1,033 meters",
      duration: "1.5 - 2 hours",
      distance: "3-4 km",
      bestTime: "June to February",
      grade: "Easy",
      description: "Lohagad Fort is a monsoon favorite offering lush greenery, historical gates, and panoramic views from the famous Vinchukata (Scorpion’s Tail) extension.",
      history: "Lohagad was used by several dynasties including Satavahanas, Chalukyas, Rashtrakutas, and later captured by Chhatrapati Shivaji Maharaj in 1648. The fort played a key role as a treasury and military outpost due to its strategic location near the Konkan trade route.",
      structures: ["Ganesh Darwaza", "Hanuman Darwaza", "Narayan Darwaza", "Vinchukata cliff"],
      waterSources: ["Rock-cut water cisterns", "Seasonal waterfalls", "Natural springs"],
      temples: ["Lord Shiva Temple", "Ganesh Temple"],
      viewpoints: ["Vinchukata extension", "Top bastion", "Entrance stairway viewpoint"],
      attractions: ["Historic gateways", "Panoramic valley views", "Monsoon foggy trails", "Lohagad-Visapur twin fort range"],
      photographySpots: ["Vinchukata curve", "Misty fort steps", "Fort wall panoramas", "Green valley landscapes"],
      wildlife: ["Monkeys", "Butterflies", "Snakes (non-venomous)", "Seasonal flowers and shrubs"],
      facilities: ["Parking at base", "Food stalls (seasonal)", "Resting spots", "Basic signage"],
      routeDescription: "The trail from Malavli station to Lohagad is well-trodden and mostly paved. The path includes gradual climbs and scenic stretches through forests and waterfalls in monsoon.",
      baseVillageDetails: "Malavli village serves as the starting point, easily accessible by local train from Pune and Mumbai. The village has food joints, parking, and guide options.",
      pointsOfInterest: [
        { name: "Ganesh Darwaza", lat: 18.7095, lng: 73.4810, type: "entrance" },
        { name: "Vinchukata Cliff", lat: 18.7108, lng: 73.4775, type: "viewpoint" },
        { name: "Rock Cistern", lat: 18.7098, lng: 73.4802, type: "water" },
        { name: "Main Fort Entrance", lat: 18.7093, lng: 73.4808, type: "entrance" }
      ]
    }
  },
  torna: {
    coordinates: { lat: 18.2786, lng: 73.6707 },
    en: {
      name: "Torna",
      location: "Velhe, Pune District",
      baseVillage: "Velhe",
      difficulty: "Difficult",
      height: "1,403 meters",
      duration: "4-5 hours",
      distance: "6-7 km",
      bestTime: "October to March",
      grade: "Difficult",
      description: "Torna, also known as Prachandgad, is the first fort captured by Shivaji Maharaj. Its massive size, steep climbs, and historical value make it a favorite among seasoned trekkers.",
      history: "Torna Fort was the first fort captured by Chhatrapati Shivaji Maharaj in 1646 at the age of 16, marking the beginning of the Maratha Empire. Due to its large size and strong fortifications, it is also called Prachandgad (Mighty Fort).",
      structures: ["Zunjar Machi", "Budhla Machi", "Mengai Temple", "Large fort walls and bastions"],
      waterSources: ["Natural rock cisterns", "Seasonal streams", "Temple tanks"],
      temples: ["Mengai Devi Temple", "Shiv Temple"],
      viewpoints: ["Zunjar Machi", "Budhla Machi", "Main entrance bastion"],
      attractions: ["Gigantic fort area", "Rock-cut stairways", "Ancient gates", "Historic temples"],
      photographySpots: ["Zunjar Machi ridge", "Sunrise from Budhla Machi", "Temple view with clouds", "Wide-angle top plateau shots"],
      wildlife: ["Mountain goats", "Langurs", "Birds of prey", "Wildflowers during monsoon"],
      facilities: ["Basic shelters", "Campsites", "Local food stalls at base (limited)", "First aid at Velhe"],
      routeDescription: "The trek starts from Velhe village and passes through dense forest and steep rocky climbs. Zunjar and Budhla Machis require careful footing, especially during monsoon.",
      baseVillageDetails: "Velhe is the base village with limited facilities but available local guidance and home-cooked food. It is connected by road from Pune (around 50 km).",
      pointsOfInterest: [
        { name: "Mengai Devi Temple", lat: 18.2790, lng: 73.6698, type: "temple" },
        { name: "Zunjar Machi", lat: 18.2802, lng: 73.6675, type: "viewpoint" },
        { name: "Budhla Machi", lat: 18.2775, lng: 73.6722, type: "viewpoint" },
        { name: "Main Fort Entrance", lat: 18.2782, lng: 73.6705, type: "entrance" }
      ]
    }
  },
  harishchandragad: {
    coordinates: { lat: 19.3900, lng: 73.6080 },
    en: {
      name: "Harishchandragad",
      location: "Ahmednagar District",
      baseVillage: "Khireshwar/Nalichi Vaat",
      difficulty: "Difficult",
      height: "1,424 meters",
      duration: "6-8 hours",
      distance: "8-10 km",
      bestTime: "October to February",
      grade: "Difficult",
      description: "One of the most famous and challenging treks, known for the spectacular Konkankada (overhanging cliff), Taramati Peak, and ancient temples.",
      history: "The fort finds its origin in the 6th century, during the rule of the Kalachuri dynasty. It is mentioned in various Puranas. Its strategic value was utilized by the Marathas, Mughals, and the Nizam Shahis.",
      structures: ["Kedareshwar Cave Temple", "Konkankada cliff", "Taramati Peak", "Saptatirtha Pushkarini"],
      waterSources: ["Rock-cut water tanks (perennial)", "Natural caves"],
      temples: ["Kedareshwar Temple", "Harishchandreshwar Temple"],
      viewpoints: ["Konkankada", "Taramati Peak (Highest point)", "Temple area plateau"],
      attractions: ["Konkankada reverse waterfall effect (monsoon)", "Ancient caves and carvings", "Night camping under the stars", "Panoramic view of Malshej Ghat"],
      photographySpots: ["Konkankada silhouette", "Sunrise from Taramati Peak", "Kedareshwar Lingam", "Misty valley views"],
      wildlife: ["Leopards (rare)", "Wild boar", "Various bird species", "Diverse medicinal flora"],
      facilities: ["Tent/Cave stay options", "Local food/tea stalls", "Guide availability", "Limited toilet facilities"],
      routeDescription: "Multiple routes exist: Khireshwar (Moderate) and Nalichi Vaat (Challenging, involving rock patches and ladders). Both are long and require fitness.",
      baseVillageDetails: "Khireshwar offers basic accommodation and food. Nalichi Vaat is more remote, requiring skilled local guides.",
      pointsOfInterest: [
        { name: "Konkankada", lat: 19.3910, lng: 73.6065, type: "viewpoint" },
        { name: "Kedareshwar Cave", lat: 19.3895, lng: 73.6085, type: "monument" },
        { name: "Taramati Peak", lat: 19.3920, lng: 73.6090, type: "viewpoint" },
        { name: "Harishchandreshwar Temple", lat: 19.3890, lng: 73.6078, type: "temple" }
      ]
    }
  },
  salher: {
    coordinates: { lat: 20.7300, lng: 74.3840 },
    en: {
      name: "Salher",
      location: "Baglan Taluka, Nashik District",
      baseVillage: "Waghambe",
      difficulty: "Moderate",
      height: "1,567 meters",
      duration: "5-6 hours",
      distance: "7-8 km",
      bestTime: "October to March",
      grade: "Moderate",
      description: "Salher is the highest fort in Maharashtra, known for its challenging ascent and historical significance as the site of a major battle between the Marathas and the Mughals.",
      history: "Salher was a strategic stronghold, especially during the Maratha-Mughal wars. The great Battle of Salher (1672) was a significant victory for Shivaji Maharaj, demonstrating Maratha power in the region.",
      structures: ["Ganesh Darwaza", "Main fort entrance", "Statues of Ganga and Jamuna", "Temple of Lord Parshuram"],
      waterSources: ["Multiple cisterns (perennial)", "Seasonal tanks"],
      temples: ["Lord Parshuram Temple", "Goddess Renuka Devi Temple"],
      viewpoints: ["Highest point bastion", "View of Salota Fort", "Saptashrungi hill view"],
      attractions: ["Highest peak of Maharashtra", "Lord Parshuram Temple", "Historic battlefield remnants", "Panoramic view of the Satpuda range"],
      photographySpots: ["Parshuram Temple architecture", "Views of the plains", "Stone steps and gateways", "Sunrise and sunset views"],
      wildlife: ["Wild boar (rare)", "Foxes", "Eagles", "Diverse plant species"],
      facilities: ["Basic accommodation in caves/temple", "Local food at base", "Guide availability", "No permanent facilities on top"],
      routeDescription: "The trek involves a long walk through the plateau followed by a moderately steep climb with well-maintained steps near the top. The path is scenic but requires endurance.",
      baseVillageDetails: "Waghambe village is the main base, offering basic amenities, parking, and local guides for hire. It is situated on the Nashik-Satana road.",
      pointsOfInterest: [
        { name: "Parshuram Temple", lat: 20.7305, lng: 74.3835, type: "temple" },
        { name: "Salota Fort View", lat: 20.7290, lng: 74.3850, type: "viewpoint" },
        { name: "Ganesh Darwaza", lat: 20.7295, lng: 74.3845, type: "entrance" },
        { name: "Statues of Ganga-Jamuna", lat: 20.7300, lng: 74.3840, type: "monument" }
      ]
    }
  },
  sindhudurg: {
    coordinates: { lat: 16.6360, lng: 73.4560 },
    en: {
      name: "Sindhudurg",
      location: "Malvan, Sindhudurg District",
      baseVillage: "Malvan Jetty (Boat access)",
      difficulty: "Easy",
      height: "Sea Level",
      duration: "2-3 hours (tour duration)",
      distance: "1 km (fort circumference)",
      bestTime: "October to May",
      grade: "Easy (Sightseeing/Tour)",
      description: "A spectacular sea fort built by Shivaji Maharaj on an island, Sindhudurg is a masterpiece of naval architecture and history. It is a heritage tour, not a strenuous trek.",
      history: "Built by Chhatrapati Shivaji Maharaj in 1664 to counter the foreign powers' dominance of the Arabian Sea. It covers an area of 48 acres and remains an outstanding example of Maratha naval strategy and fortification.",
      structures: ["Shiva Temple (Only temple with Shivaji's masked image)", "Handprint and footprint of Shivaji", "Massive sea walls", "Zunjar Buruj (Brave Bastion)"],
      waterSources: ["Dudhal Baw", "Ran Baw", "Water tanks (sweet water source)"],
      temples: ["Shiva Temple (Shivaji's Temple)", "Bhavani Temple"],
      viewpoints: ["Massive ramparts overlooking the Arabian Sea", "Zunjar Buruj", "Base of the fort walls"],
      attractions: ["Shivaji's preserved hand and footprint", "Stone inscriptions and carvings", "Unique sea architecture", "Panoramic ocean views"],
      photographySpots: ["Fort walls against the ocean", "Sunrise/Sunset over the sea", "Boat journey to the fort", "Temple architecture"],
      wildlife: ["Seabirds", "Marine life (visible from boat)", "Coastal vegetation"],
      facilities: ["Boat service (mandatory)", "Local guides on fort", "Rest areas", "Small shops for refreshments"],
      routeDescription: "Access is by boat from Malvan jetty. The tour inside the fort involves walking along ramparts and pathways, which is easy.",
      baseVillageDetails: "Malvan town provides ample hotels, resorts, and local Malvani cuisine. The jetty is the starting point for the boat ride to the fort.",
      pointsOfInterest: [
        { name: "Shivaji Temple", lat: 16.6358, lng: 73.4562, type: "temple" },
        { name: "Shivaji's Handprint/Footprint", lat: 16.6365, lng: 73.4558, type: "monument" },
        { name: "Zunjar Buruj", lat: 16.6370, lng: 73.4565, type: "viewpoint" },
        { name: "Malvan Jetty", lat: 16.6350, lng: 73.4570, type: "entrance" }
      ]
    }
  }
};

let currentFortId = null;
let map = null;
let isUserPremium = false;
let isUserAdmin = false;

function getURLParameter(name) {
  return new URLSearchParams(window.location.search).get(name);
}

function checkUserAccess() {
  const userToken = localStorage.getItem('userToken');
  const userRole = localStorage.getItem('userRole');
  
  if (userToken) {
    if (userRole === 'admin' || userRole === 'organizer') {
      isUserAdmin = true;
      isUserPremium = true;
    } else {
      const hasPurchasedPackage = localStorage.getItem('hasPurchasedPackage');
      isUserPremium = hasPurchasedPackage === 'true';
    }
  }
  
  updateMapAccess();
}

function updateMapAccess() {
  const premiumNotice = document.getElementById('premiumNotice');
  const mapControls = document.getElementById('mapControls');
  
  if (isUserPremium || isUserAdmin) {
    premiumNotice.style.display = 'none';
    mapControls.style.display = 'block';
  } else {
    premiumNotice.style.display = 'flex';
    mapControls.style.display = 'none';
  }
}

function initializeMap(fortData) {
  const mapOptions = {
    zoom: 15,
    center: fortData.coordinates,
    mapTypeId: google.maps.MapTypeId.TERRAIN
  };
  
  map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);
  
  const mainMarker = new google.maps.Marker({
    position: fortData.coordinates,
    map: map,
    title: fortData.en.name,
    icon: {
      url: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
      scaledSize: new google.maps.Size(40, 40)
    }
  });
  
  const mainInfoWindow = new google.maps.InfoWindow({
    content: `<div style="padding:10px;"><h3>${fortData.en.name}</h3><p>${fortData.en.description}</p></div>`
  });
  
  mainMarker.addListener('click', function() {
    mainInfoWindow.open(map, mainMarker);
  });
  
  if (fortData.en.pointsOfInterest) {
    fortData.en.pointsOfInterest.forEach(function(poi) {
      const poiMarker = new google.maps.Marker({
        position: { lat: poi.lat, lng: poi.lng },
        map: map,
        title: poi.name,
        icon: {
          url: getMarkerIcon(poi.type),
          scaledSize: new google.maps.Size(30, 30)
        }
      });
      
      const poiInfoWindow = new google.maps.InfoWindow({
        content: `<div style="padding:8px;"><h4>${poi.name}</h4><p>Type: ${poi.type}</p></div>`
      });
      
      poiMarker.addListener('click', function() {
        poiInfoWindow.open(map, poiMarker);
      });
    });
  }
}

function getMarkerIcon(type) {
  switch(type) {
    case 'temple': return 'https://maps.google.com/mapfiles/ms/icons/yellow-dot.png';
    case 'viewpoint': return 'https://maps.google.com/mapfiles/ms/icons/green-dot.png';
    case 'monument': return 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png';
    case 'entrance': return 'https://maps.google.com/mapfiles/ms/icons/purple-dot.png';
    case 'palace': return 'https://maps.google.com/mapfiles/ms/icons/orange-dot.png';
    case 'memorial': return 'https://maps.google.com/mapfiles/ms/icons/pink-dot.png';
    default: return 'https://maps.google.com/mapfiles/ms/icons/yellow-dot.png';
  }
}

function loadFortData(fortId) {
  const fort = fortsData[fortId];
  if (!fort) {
    document.getElementById('fortName').textContent = 'Fort not found';
    return;
  }

  currentFortId = fortId;
  const fortData = fort.en; // Only English content
  updateContent(fortData);
  
  const heroSection = document.getElementById('fortHero');
  heroSection.style.backgroundImage = `linear-gradient(rgba(40,20,10,0.7), rgba(40,20,10,0.7)), url('images/${fortId}.jpg')`;
  
  document.getElementById('fortImage').src = `images/${fortId}.jpg`;
  document.getElementById('fortImage').alt = fortData.name;
}

function updateContent(fortData) {
  document.getElementById('fortName').textContent = fortData.name;
  document.getElementById('fortLocation').textContent = fortData.location;
  document.getElementById('baseVillage').textContent = fortData.baseVillage;
  document.getElementById('difficulty').textContent = fortData.difficulty;
  document.getElementById('height').textContent = fortData.height;
  document.getElementById('fortDescription').textContent = fortData.description;
  document.getElementById('historyContent').textContent = fortData.history;
  document.getElementById('duration').textContent = fortData.duration;
  document.getElementById('distance').textContent = fortData.distance;
  document.getElementById('bestTime').textContent = fortData.bestTime;
  document.getElementById('grade').textContent = fortData.grade;
  document.getElementById('routeText').textContent = fortData.routeDescription;
  document.getElementById('baseVillageDetails').textContent = fortData.baseVillageDetails;

  const difficulty = fortData.difficulty.toLowerCase();
  const difficultyBadge = document.getElementById('difficulty');
  difficultyBadge.className = `stat-value difficulty-badge difficulty-${difficulty === 'easy' ? 'easy' : difficulty === 'moderate' || difficulty.includes('moderate') ? 'moderate' : 'difficult'}`;

  updateLists('structures', fortData.structures);
  updateLists('waterSources', fortData.waterSources);
  updateLists('temples', fortData.temples);
  updateLists('viewpoints', fortData.viewpoints);
  updateLists('attractions', fortData.attractions);
  updateLists('photographySpots', fortData.photographySpots);
  updateLists('wildlife', fortData.wildlife);
  updateLists('facilities', fortData.facilities);
}

function updateLists(elementId, items) {
  const element = document.getElementById(elementId);
  if (element && items) {
    element.innerHTML = items.map(item => `<li>${item}</li>`).join('');
  }
}

// REMOVED: function toggleLanguage() {}

function showMap() {
  const mapDisplay = document.getElementById('mapDisplay');
  const viewMapBtn = document.getElementById('viewMapBtn');
  
  if (mapDisplay.style.display === 'none') {
    mapDisplay.style.display = 'block';
    viewMapBtn.textContent = 'Hide Map';
    
    if (!map && currentFortId && fortsData[currentFortId]) {
      setTimeout(() => {
        initializeMap(fortsData[currentFortId]);
      }, 100);
    }
  } else {
    mapDisplay.style.display = 'none';
    viewMapBtn.textContent = 'View Map';
  }
}

document.addEventListener('DOMContentLoaded', function() {
  const fortId = getURLParameter('id') || 'pratapgad';
  
  checkUserAccess();
  
  if (fortId && fortsData[fortId]) {
    loadFortData(fortId);
  }
  
  // REMOVED: document.getElementById('langToggle').addEventListener('click', toggleLanguage);
  
  document.getElementById('viewMapBtn').addEventListener('click', showMap);
});